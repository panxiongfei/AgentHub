# æ‰£å­ç©ºé—´å†å²ä»»åŠ¡è·å–åŠä¸‹è½½ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨AgentHubç³»ç»Ÿè·å–å’Œä¸‹è½½æ‰£å­ç©ºé—´ï¼ˆspace.coze.cnï¼‰å¹³å°çš„å†å²ä»»åŠ¡ã€‚ç³»ç»Ÿå·²å®Œæ•´é›†æˆæ‰£å­ç©ºé—´å¹³å°ï¼Œæ”¯æŒå†å²å¯¹è¯å’Œå·¥ä½œæµçš„è‡ªåŠ¨å‘ç°ã€å†…å®¹æå–å’Œæ‰¹é‡ä¸‹è½½ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… **å†å²ä»»åŠ¡è‡ªåŠ¨å‘ç°** - æ™ºèƒ½è¯†åˆ«é¡µé¢ä¸­çš„å†å²å¯¹è¯å’Œå·¥ä½œæµ
- âœ… **å†…å®¹æ™ºèƒ½æå–** - æ”¯æŒå¯¹è¯æ¶ˆæ¯ã€å·¥ä½œæµç»“æœçš„ç»“æ„åŒ–æå–
- âœ… **æ‰¹é‡æ–‡ä»¶ä¸‹è½½** - è‡ªåŠ¨ä¿å­˜å¯¹è¯å†…å®¹ã€å…ƒæ•°æ®ã€æˆªå›¾ã€HTMLæºç 
- âœ… **å¤šæ¨¡å¼æ“ä½œ** - æ”¯æŒäº¤äº’å¼é€‰æ‹©ã€å¿«é€Ÿä¸‹è½½ã€å‘½ä»¤è¡Œæ‰¹é‡å¤„ç†

### é«˜çº§ç‰¹æ€§
- ğŸ”„ **å·¥ä½œæµæ”¯æŒ** - ä¸“é—¨é€‚é…æ‰£å­ç©ºé—´çš„å·¥ä½œæµåŠŸèƒ½
- ğŸ¤ **åä½œæ¨¡å¼** - æ”¯æŒå¤šäººåä½œå†…å®¹çš„æå–
- ğŸ¯ **æ™ºèƒ½é€‰æ‹©å™¨** - 40+é¡µé¢é€‰æ‹©å™¨ï¼Œé€‚åº”ä¸åŒé¡µé¢ç»“æ„
- ğŸ“Š **è¯¦ç»†æŠ¥å‘Š** - è‡ªåŠ¨ç”Ÿæˆä¸‹è½½ç»Ÿè®¡å’Œè´¨é‡åˆ†æ

## âš™ï¸ å‰ç½®æ¡ä»¶

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# ç¡®ä¿AgentHubç¯å¢ƒå·²å®‰è£…
cd AgentHub
source .venv/bin/activate  # æˆ– .venv\Scripts\activate (Windows)

# éªŒè¯ä¾èµ–
python -c "import playwright; print('Playwrightå·²å®‰è£…')"
```

### 2. æµè§ˆå™¨é…ç½®
```bash
# å¯åŠ¨Chromeè°ƒè¯•æ¨¡å¼ï¼ˆå¿…éœ€ï¼‰
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome \
  --remote-debugging-port=9222 \
  --user-data-dir=/tmp/chrome-debug-agenthub \
  --no-first-run --no-default-browser-check &

# éªŒè¯è°ƒè¯•ç«¯å£
curl http://localhost:9222/json
```

### 3. ç™»å½•æ‰£å­ç©ºé—´
1. åœ¨å¯åŠ¨çš„Chromeæµè§ˆå™¨ä¸­è®¿é—® https://space.coze.cn
2. å®Œæˆç™»å½•æµç¨‹
3. ç¡®ä¿èƒ½çœ‹åˆ°å†å²å¯¹è¯æˆ–å·¥ä½œæµåˆ—è¡¨

### 4. å¯åŠ¨AgentHubæœåŠ¡
```bash
# å¯åŠ¨åå°æœåŠ¡
python main.py serve &

# éªŒè¯æœåŠ¡çŠ¶æ€
curl http://localhost:8000/health
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šäº¤äº’å¼ä¸‹è½½ï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œäº¤äº’å¼ä¸‹è½½å·¥å…·
python coze_space_history_downloader.py

# æˆ–æ˜¾å¼æŒ‡å®šäº¤äº’æ¨¡å¼
python coze_space_history_downloader.py interactive
```

**äº¤äº’æµç¨‹ï¼š**
1. è‡ªåŠ¨å‘ç°å†å²ä»»åŠ¡
2. æ˜¾ç¤ºä»»åŠ¡åˆ—è¡¨å’Œæ•°é‡
3. é€‰æ‹©ä¸‹è½½æ–¹å¼ï¼ˆå…¨éƒ¨/å‰Nä¸ª/è‡ªå®šä¹‰/ç‰¹å®šä»»åŠ¡ï¼‰
4. è‡ªåŠ¨åˆ›å»ºä¸‹è½½ç›®å½•
5. é€ä¸ªä¸‹è½½å¹¶æ˜¾ç¤ºè¿›åº¦
6. ç”Ÿæˆå®Œæ•´çš„ä¸‹è½½æŠ¥å‘Š

### æ–¹æ³•äºŒï¼šå¿«é€Ÿä¸‹è½½

```bash
# å¿«é€Ÿä¸‹è½½å‰5ä¸ªä»»åŠ¡
python coze_space_history_downloader.py quick

# å¿«é€Ÿä¸‹è½½å‰10ä¸ªä»»åŠ¡  
python coze_space_history_downloader.py quick10
```

### æ–¹æ³•ä¸‰ï¼šä»…æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨

```bash
# åªæ˜¾ç¤ºå†å²ä»»åŠ¡åˆ—è¡¨ï¼Œä¸ä¸‹è½½
python coze_space_history_downloader.py list
```

### æ–¹æ³•å››ï¼šç¼–ç¨‹æ–¹å¼è°ƒç”¨

```python
import asyncio
from app.platforms.platform_factory import PlatformFactory

async def download_coze_history():
    # åˆ›å»ºå¹³å°å®ä¾‹
    factory = PlatformFactory()
    platform = await factory.create_platform("coze_space")
    
    # è·å–å†å²ä»»åŠ¡
    history_tasks = await platform.get_history_tasks()
    print(f"å‘ç° {len(history_tasks)} ä¸ªå†å²ä»»åŠ¡")
    
    # ä¸‹è½½å•ä¸ªä»»åŠ¡
    if history_tasks:
        task = history_tasks[0]
        download_dir = Path("data/my_downloads")
        files = await platform.download_history_task(task, download_dir)
        print(f"ä¸‹è½½å®Œæˆ: {len(files)} ä¸ªæ–‡ä»¶")

# è¿è¡Œ
asyncio.run(download_coze_history())
```

## ğŸ“ ä¸‹è½½æ–‡ä»¶ç»“æ„

æ¯ä¸ªä¸‹è½½çš„ä»»åŠ¡ä¼šåˆ›å»ºç‹¬ç«‹ç›®å½•ï¼ŒåŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

```
data/coze_space_history_downloads/batch_1733123456/
â”œâ”€â”€ task_coze_space_history_0_1733123456/
â”‚   â”œâ”€â”€ conversation.txt      # å¯¹è¯å†…å®¹ï¼ˆä¸»è¦æ–‡ä»¶ï¼‰
â”‚   â”œâ”€â”€ metadata.json         # ä»»åŠ¡å…ƒæ•°æ®
â”‚   â”œâ”€â”€ screenshot.png        # é¡µé¢æˆªå›¾
â”‚   â””â”€â”€ page.html            # å®Œæ•´HTMLæºç 
â”œâ”€â”€ task_coze_space_history_1_1733123456/
â”‚   â”œâ”€â”€ conversation.txt
â”‚   â”œâ”€â”€ metadata.json
â”‚   â”œâ”€â”€ screenshot.png
â”‚   â””â”€â”€ page.html
â””â”€â”€ download_report.json      # æ‰¹é‡ä¸‹è½½æŠ¥å‘Š
```

### æ–‡ä»¶è¯´æ˜

#### conversation.txt
```
æ‰£å­ç©ºé—´å†å²ä»»åŠ¡
ä»»åŠ¡ID: coze_space_history_0_1733123456
æ ‡é¢˜: AIæŠ€æœ¯å‘å±•è¶‹åŠ¿åˆ†æ
æ—¥æœŸ: 2024-06-01 20:30:15
URL: https://space.coze.cn/chat/12345
==================================================

**ç”¨æˆ·è¾“å…¥:**
è¯·åˆ†æå½“å‰AIæŠ€æœ¯çš„å‘å±•è¶‹åŠ¿å’ŒæŒ‘æˆ˜

**AIå›å¤:**
å½“å‰AIæŠ€æœ¯å‘å±•å‘ˆç°ä»¥ä¸‹å‡ ä¸ªé‡è¦è¶‹åŠ¿...

**å·¥ä½œæµæ‰§è¡Œç»“æœ:**
[å·¥ä½œæµåç§°]: æŠ€æœ¯è¶‹åŠ¿åˆ†ææµç¨‹
[æ‰§è¡ŒçŠ¶æ€]: æˆåŠŸ
[è¾“å‡ºç»“æœ]: ...
```

#### metadata.json
```json
{
  "id": "coze_space_history_0_1733123456",
  "title": "AIæŠ€æœ¯å‘å±•è¶‹åŠ¿åˆ†æ",
  "date": "2024-06-01 20:30:15",
  "url": "https://space.coze.cn/chat/12345",
  "status": "completed",
  "platform": "coze_space",
  "metadata": {
    "workflow_enabled": true,
    "collaborative_mode": true,
    "extraction_time": "2024-06-01 21:00:00"
  }
}
```

#### download_report.json
```json
{
  "download_time": "2024-06-01 21:00:00",
  "platform": "coze_space",
  "summary": {
    "total_tasks": 10,
    "successful_tasks": 9,
    "failed_tasks": 1,
    "success_rate": 0.9
  },
  "results": [...]
}
```

## ğŸ§ª åŠŸèƒ½æµ‹è¯•

åœ¨ä½¿ç”¨å‰ï¼Œå»ºè®®å…ˆè¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š

```bash
# è¿è¡Œå®Œæ•´åŠŸèƒ½æµ‹è¯•
python test_coze_space_history.py

# æ£€æŸ¥æµ‹è¯•ç»“æœ
# âœ… å¹³å°åˆ›å»ºæˆåŠŸ
# âœ… æµè§ˆå™¨è¿æ¥æ­£å¸¸  
# âœ… é¡µé¢åˆ†æåŠŸèƒ½æ­£å¸¸
# âœ… å†å²ä»»åŠ¡å‘ç°æ­£å¸¸
# âœ… å†…å®¹æå–åŠŸèƒ½æ­£å¸¸
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. æµè§ˆå™¨è¿æ¥å¤±è´¥
```
âŒ æµè§ˆå™¨è¿æ¥å¼‚å¸¸: Could not connect to Chrome
```
**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥Chromeè¿›ç¨‹
ps aux | grep chrome

# é‡å¯Chromeè°ƒè¯•æ¨¡å¼
pkill -f "chrome.*remote-debugging"
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome \
  --remote-debugging-port=9222 \
  --user-data-dir=/tmp/chrome-debug-agenthub &

# éªŒè¯ç«¯å£
curl http://localhost:9222/json
```

#### 2. æœªå‘ç°å†å²ä»»åŠ¡
```
âš ï¸ æœªå‘ç°å†å²ä»»åŠ¡ï¼Œå¯èƒ½åŸå› :
   1. é¡µé¢ä¸­æ²¡æœ‰å†å²å¯¹è¯/å·¥ä½œæµ
   2. é¡µé¢ç»“æ„å‘ç”Ÿå˜åŒ–
   3. éœ€è¦æ»šåŠ¨æˆ–åˆ‡æ¢åˆ°å†å²é¡µé¢
```
**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿å·²ç™»å½•æ‰£å­ç©ºé—´å¹¶æœ‰å†å²è®°å½•
2. åœ¨æµè§ˆå™¨ä¸­æ‰‹åŠ¨å¯¼èˆªåˆ°å†å²é¡µé¢
3. ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½åå†è¿è¡Œå·¥å…·
4. æ£€æŸ¥æ˜¯å¦éœ€è¦å±•å¼€ä¾§è¾¹æ æˆ–å†å²åˆ—è¡¨

#### 3. å†…å®¹æå–å¤±è´¥
```
âŒ å†…å®¹æå–å¤±è´¥: No messages found
```
**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿å·²æ­£ç¡®æ‰“å¼€å¯¹è¯é¡µé¢
2. ç­‰å¾…é¡µé¢å†…å®¹å®Œå…¨æ¸²æŸ“
3. æ£€æŸ¥é¡µé¢æ˜¯å¦éœ€è¦æ»šåŠ¨åŠ è½½æ›´å¤šå†…å®¹
4. éªŒè¯é€‰æ‹©å™¨é…ç½®æ˜¯å¦éœ€è¦æ›´æ–°

#### 4. ä¸‹è½½æ–‡ä»¶ä¸å®Œæ•´
```
âš ï¸ éƒ¨åˆ†æ–‡ä»¶ä¸‹è½½å¤±è´¥
```
**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³
2. éªŒè¯æ–‡ä»¶å†™å…¥æƒé™
3. é‡è¯•ä¸‹è½½å¤±è´¥çš„ä»»åŠ¡
4. æ£€æŸ¥ç½‘ç»œè¿æ¥ç¨³å®šæ€§

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
export LOG_LEVEL=DEBUG
python coze_space_history_downloader.py

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
tail -f logs/agenthub.log
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### æ‰¹é‡ä¸‹è½½ä¼˜åŒ–
```python
# è‡ªå®šä¹‰ä¸‹è½½é…ç½®
async def optimized_batch_download():
    platform = await factory.create_platform("coze_space")
    
    # è·å–å†å²ä»»åŠ¡
    history_tasks = await platform.get_history_tasks()
    
    # åˆ†æ‰¹å¤„ç†å¤§é‡ä»»åŠ¡
    batch_size = 5
    for i in range(0, len(history_tasks), batch_size):
        batch = history_tasks[i:i+batch_size]
        await process_batch(batch)
        await asyncio.sleep(2)  # é¿å…é¢‘ç¹è¯·æ±‚
```

### å†…å­˜ç®¡ç†
```python
# å¤„ç†å¤§æ–‡ä»¶æ—¶çš„å†…å­˜ä¼˜åŒ–
async def memory_efficient_download():
    # é€ä¸ªå¤„ç†ï¼Œé¿å…åŒæ—¶åŠ è½½è¿‡å¤šå†…å®¹
    for task in history_tasks:
        await platform.download_history_task(task, download_dir)
        # é‡Šæ”¾èµ„æº
        await asyncio.sleep(1)
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä¸‹è½½ç­–ç•¥
- **å°æ‰¹é‡**: é¦–æ¬¡ä½¿ç”¨å»ºè®®ä¸‹è½½å‰5ä¸ªä»»åŠ¡è¿›è¡Œæµ‹è¯•
- **åˆ†æ—¶æ®µ**: å¤§é‡ä»»åŠ¡å»ºè®®åˆ†å¤šæ¬¡ä¸‹è½½ï¼Œé¿å…é•¿æ—¶é—´å ç”¨æµè§ˆå™¨
- **å¤‡ä»½éªŒè¯**: é‡è¦ä»»åŠ¡å»ºè®®å¤šæ¬¡ä¸‹è½½éªŒè¯å®Œæ•´æ€§

### 2. æ•°æ®ç®¡ç†
```bash
# æŒ‰æ—¥æœŸç»„ç»‡ä¸‹è½½ç›®å½•
data/coze_space_downloads/
â”œâ”€â”€ 2024-06-01/
â”œâ”€â”€ 2024-06-02/
â””â”€â”€ archive/

# å®šæœŸæ¸…ç†å’Œå½’æ¡£
find data/coze_space_downloads -name "*.png" -size +10M
```

### 3. è‡ªåŠ¨åŒ–é›†æˆ
```bash
# åˆ›å»ºå®šæ—¶ä»»åŠ¡
# æ¯æ—¥è‡ªåŠ¨å¤‡ä»½æ–°çš„å†å²ä»»åŠ¡
0 2 * * * cd /path/to/AgentHub && python coze_space_history_downloader.py quick
```

### 4. è´¨é‡æ§åˆ¶
```python
# ä¸‹è½½åéªŒè¯æ–‡ä»¶å®Œæ•´æ€§
def verify_download_quality(download_dir):
    required_files = ['conversation.txt', 'metadata.json']
    for task_dir in download_dir.glob('task_*'):
        for required_file in required_files:
            file_path = task_dir / required_file
            if not file_path.exists() or file_path.stat().st_size == 0:
                print(f"âš ï¸ æ–‡ä»¶å¼‚å¸¸: {file_path}")
```

## ğŸ”„ ç‰ˆæœ¬æ›´æ–°

### å½“å‰ç‰ˆæœ¬: v2.2.0
- âœ… å®Œæ•´çš„æ‰£å­ç©ºé—´å¹³å°é›†æˆ
- âœ… æ™ºèƒ½å†å²ä»»åŠ¡å‘ç°
- âœ… å·¥ä½œæµå’Œåä½œå†…å®¹æ”¯æŒ
- âœ… æ‰¹é‡ä¸‹è½½å’ŒæŠ¥å‘Šç”Ÿæˆ

### è®¡åˆ’åŠŸèƒ½ (v2.3.0)
- ğŸ”„ AIæ€»ç»“è‡ªåŠ¨ç”Ÿæˆ
- ğŸ”„ å¢é‡ä¸‹è½½æ”¯æŒ
- ğŸ”„ äº‘ç«¯åŒæ­¥åŠŸèƒ½
- ğŸ”„ é«˜çº§è¿‡æ»¤å’Œæœç´¢

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è·å–å¸®åŠ©
```bash
# æŸ¥çœ‹å·¥å…·å¸®åŠ©
python coze_space_history_downloader.py --help

# è¿è¡Œè¯Šæ–­å·¥å…·
python test_coze_space_history.py
```

### å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥
```bash
# åŸºç¡€æ“ä½œ
python coze_space_history_downloader.py              # äº¤äº’å¼ä¸‹è½½
python coze_space_history_downloader.py quick        # å¿«é€Ÿä¸‹è½½5ä¸ª
python coze_space_history_downloader.py list         # ä»…æŸ¥çœ‹åˆ—è¡¨

# è°ƒè¯•å’Œæµ‹è¯•
python test_coze_space_history.py                    # åŠŸèƒ½æµ‹è¯•
python test_coze_space_platform.py                   # å¹³å°æµ‹è¯•
curl http://localhost:9222/json                      # æ£€æŸ¥Chromeè°ƒè¯•

# æœåŠ¡ç®¡ç†
python main.py serve                                 # å¯åŠ¨åå°æœåŠ¡
curl http://localhost:8000/health                    # å¥åº·æ£€æŸ¥
```

---

## ğŸ‰ å¼€å§‹ä½¿ç”¨

ç°åœ¨æ‚¨å·²ç»äº†è§£äº†æ‰£å­ç©ºé—´å†å²ä»»åŠ¡è·å–å’Œä¸‹è½½çš„å®Œæ•´æµç¨‹ï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼š

1. **å‡†å¤‡ç¯å¢ƒ** - ç¡®ä¿æµè§ˆå™¨ç™»å½•å’ŒæœåŠ¡å¯åŠ¨
2. **è¿è¡Œæµ‹è¯•** - éªŒè¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ
3. **äº¤äº’ä¸‹è½½** - ä½¿ç”¨äº¤äº’æ¨¡å¼è¿›è¡Œé¦–æ¬¡ä¸‹è½½
4. **æŸ¥çœ‹ç»“æœ** - æ£€æŸ¥ä¸‹è½½çš„æ–‡ä»¶å’ŒæŠ¥å‘Š
5. **è‡ªåŠ¨åŒ–ä½¿ç”¨** - æ ¹æ®éœ€è¦é›†æˆåˆ°å·¥ä½œæµç¨‹ä¸­

**å¿«é€Ÿå¼€å§‹å‘½ä»¤ï¼š**
```bash
# ä¸€é”®å¯åŠ¨å®Œæ•´æµç¨‹
python test_coze_space_history.py && python coze_space_history_downloader.py quick
```

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼ğŸš€ 